# learning bioinformation-  3.24 differencial analysis
 - 学习内容来自[KeepNotes blog](https://www.bioinfo-scrounger.com/archives/499/)
 
## 1 Begain
  
  `install.packages("rpx")`

 - 查看[proteomexchange](http://www.proteomexchange.org/)新发布的数据:
`pxannounced()`

- 对质谱数据进行分析比对（确定多肽段的蛋白&基因名称）即为查库

 - 查库软件：
#对于raw data————try `MSnbase`

`install.packages("MSnbase)`

## 2 统计分析：R包*3
### step1 安装包
`install.packages("MSstats")`
 > for statistical relative protein signigicance analysis in **DDA,SRM and DIA.data** stored in **data.fram or MSnSet** can be used as input 
 
 `install.packages("msmsTests")`


> Statistical tests for **label-free** LC-MS/MS data by 
  **spectral counts**, to discover differentially expressed proteins between two biological conditions. Three tests are available: Poisson GLM regression, quasi-likelihood GLM regression, and the negative binomial of the edgeR package. All can be readily applied on MSnSet instances produced, for example by MSnID  
  
`install.packages("isobar")`

> This one also provides dedicated infrastructure for the statistical analysis of **isobaric data**

## step2 参考 [KeepNotes blog](https://www.bioinfo-scrounger.com/archives/541/),尝试进行差异分析（网站下载数据文件）

 `library(ggplot2)   `    
`setwd("D:/test_blog_differencially") `   
`test_data <- read.csv(file = "labelfree.csv", sep = ",", header = T, row.names = 1)`

 - Q: load csv多了一列X全部为NA值？
 - A: 数据源有问题，打开excel后选中最后几列，删除后再导入，成功

 `rm <- apply(test_data, 1, function(x){sum(x == 0) > 3
})  `  
`df <- test_data[!rm,]  `  
`nrow(df)`
 - nrow(df)这里开始出现问题，和原文结果有差异，果然，后面出岔子了

 - 为什么进行log转化？ 
 - 丰度值数据分布非常离散,可尝试计算均值和方差:
 
`Mean <- apply(df, 2, mean)  `
`SD <- apply(df, 2, sd)  `  
`Mean  `  
`SD`
! image.pn**g**


 - 差异分析使用何种数据？
  - >limma & MSstats必须进行对数转化，前者默认输入数据已经做了log转化，后者根据参数来设定如何进行log转化  
 另：**T检验或者方差分析**需要数据符合**方差齐性**，实验过程中误差可能越来越大，因此对数变化可以将方差变大的趋势调回来

### step3  尝试进行T test
 - 需要样本总体符合正态分布，并且为方差齐性，首先进行F检验  
` fvalue <- apply(df, 1, function(x){  
     a <- factor(c(rep("A", 3), rep("B", 3)))  
  var.test(x~a)
})  `  
`sum(unlist(lapply(fvalue, function(x){
  x$p.value > 0.05
})))`

 - 结果表示5325个蛋白中有4605个满足方差齐性

 - t test进行**成组T检验，双尾检验**。若为方差不齐，则用`var.equal = FALSE`   

### step4 calculate P value



`pvalue <- apply(df, 1, function(x){  
a <- factor(c(rep("A",3), rep("B",3)))  
   fvalue <-var.test(x~a)  
  if (fvalue$p.value >0.05){  
    t.test(x~a, var.equal = T)  
  }else{   
    t.test(x~a, var.equal = F)  
  }
})`

!
`result_ttest <- data.frame(ID=row.names(df),
                           Pvalue = as.numeric(unlist(lapply(pvalue,function(x) x$p.value))),
                           log2FC = log2(as.numeric(unlist(lapply(pvalue, function(x) x$estimate[1]/x$estimate[2]))))
                           )`


`sum(result_ttest$Pvalue < 0.05 & abs(result_ttest$log2FC) > 1)`





 
















































